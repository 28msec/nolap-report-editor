box: dignifiedquire/node-firefox-headless@0.2.4
build:
    steps:
        - script:
            name: setup headless firefox
            code: |
                echo "Installing Firefox v#31.0"
                sudo mkdir -p /usr/local/firefox-#31.0
                sudo chown -R wercker /usr/local/firefox-#31.0
                wget -O /tmp/firefox.tar.bz2 http://ftp.mozilla.org/pub/firefox/releases/#31.0/linux-x86_64/en-US/firefox-#31.0.tar.bz2
                pushd /usr/local/firefox-#31.0
                tar xf /tmp/firefox.tar.bz2
                sudo ln -sf /usr/local/firefox-#31.0/firefox/firefox /usr/local/bin/firefox
                sudo ln -sf /usr/local/firefox-#31.0/firefox/firefox-bin /usr/local/bin/firefox-bin
                popd
                export DISPLAY=:99.0
                sh -e /etc/init.d/xvfb start
        - aussiegeek/install-phantomjs@0.0.3
        - npm-install
        - hgen/bower-install@0.5.7
        - script:
            name: Build
            code: |
                ./node_modules/grunt-cli/bin/grunt static-checks
        - script:
            name: Unit tests
            code: |
                ./node_modules/grunt-cli/bin/grunt karma
        - script:
            name: Saucelabs
            code: |
                mkdir -p $LOGS_DIR
                ./scripts/sauce_connect_setup.sh
                ./node_modules/protractor/scripts/wait_for_browser_provider.sh
                ./node_modules/grunt-cli/bin/grunt e2e-saucelabs
